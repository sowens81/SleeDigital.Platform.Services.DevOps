parameters:
    - name: solutionDirectory
      type: string
    - name: buildConfiguration
      type: string
    - name: orginisation
      type: string
    - name: project
      type: string
    - name: host
      type: string

steps:

- task: Bash@3
  displayname: Install SonarCloud Agent
  inputs:
    targetType: inline
    script: |
        dotnet tool install --global dotnet-sonarscanner
    env:

- task: Bash@3
  displayname: Run SonarCloud Scan
  inputs:
    targetType: 'inline'
    script: |
        dotnet sonarscanner begin \
            /o:$SONAR_ORG \
            /k:$SONAR_PROJECT \
            /d:sonar.host.url=$SONAR_HOST
        dotnet build %SOLUTIONDIRECTORY% --configuration $BUILD_CONFIGURATION
        dotnet sonarscanner end
    env:
      BUILD_CONFIGURATION: ${{ parameters.buildConfiguration }}
      SONAR_ORG: ${{ parameters.orginisation }}
      SONAR_PROJECT: ${{ parameters.project }}
      SONAR_HOST: ${{ parameters.host }}
      SOLUTION_DIRECTORY:  ${{ parameters.solutionDirectory }}
      SONAR_TOKEN: ${SONAR_TOKEN}








